# HTML 안에 `<script>`는 어디에 넣는게 좋을까?

사람들은 `<head>` 섹션에 삽입하면 좋지 않다고 하지만, `<body>` 섹션의 시작 부분에 놓는 것 또한 나쁘다고 한다. 왜냐하면 자바 스크립트는 페이지가 완전히 렌더링되기 전에 파싱되어야 하기 때문이다.

그럼.. `<body>` 섹션의 끝에 놓는 방법만이 남은것 같아 보인다.

그렇다면 `<script>` 태그를 넣을 수 있는 가장 적합한 곳은 어디일까?

1. ### 브라우저에서 웹 사이트를 로드 할 때 일어나는 일

   1. HTML 페이지 가져오기
   2. HTML 구문분석 시작
   3. 파서는 외부 스크립트 파일을 참조하는 <script> 태그 발견
   4. 브라우저가 스크립트 파일을 요청. 파서는 페이지의 다른 HTML 파일 구문 분석 하는것을 차단
   5. 잠시 후 스크립트가 다운로드 된 후 실행
   6. 파서는 나머지 HTML 문서를 계속 파싱

4번은 좋지 않은 사용자 환경을 유발한다. 왜냐하면 웹 사이트는 기본적으로 모든 스크립트를 다운로드 할 때 까지 로드를 중지하는데 사용자는 웹 사이트가 로드 될 때까지 기다리는 것을 싫어하기 때문이다.

2. ### 해결 방법 ( 고전 )

`<body>` 섹션 맨 아래에 `<script>` 태그를 넣는 것이다. 이렇게 한다면 구문 분석이 끝나고 스크립트 파일을 다운로드 받기 때문이다. ( 파서가 맨 끝까지 차단되지 않는다. )

하지만 이 방식은, 브라우저가 전체 문서의 구문 분석이 될 때까지 스크립트를 다운로드 할 수가 없다. 큰 스트립트 및 스타일 시트가 있는 큰 웹사이트 경우 가능한 빨리 스크립트를 다운로드 하는 것이 성능향상에 매우 중요하다. 

최적의 솔류션은 가능한 한 빨리 스크립트를 다운로드 하는 동시에 문서의 나머지 부분을 파싱 하는 것이다.

3. ### 해결 방법( 현대 )

>  [Peter Beverloo씨가 그린 도표](http://peter.sh/experiments/asynchronous-and-deferred-javascript-execution-explained/)

<img width="592" alt="스크린샷 2019-05-17 오후 1 55 17" src="https://user-images.githubusercontent.com/39187116/57904058-2a3f2480-78ac-11e9-86a4-388f9faee3bf.png">

오늘날 브라우저는 스크립트의 비동기 및 지연 특성을 지원한다. 이러한 속성은 스크립트가 다운로드 되는 동안 계속 구문 분석을 하는 것이 안전하다는 것을 브라우저에 알려준다.

###### async

```html
<script type="text/javascript" src="path/to/script1.js" async></script>
<script type="text/javascript" src="path/to/script2.js" async></script>
```

async 속성이 있는 스크립트는 비동기 적으로 실행된다. 즉, 스크립트가 다운로드되는 즉시 브라우저가 차단되지 않고 실행된다. 이는 스크립트 2가 스크립트 1 이전에 다운로드 및 실행될 수 있음을 의미한다. ( 90 퍼센트의 브라우저가 이 기능을 지원한다. )

_script 문서간 의존성이 떨어진다면 사용하면 좋아!_

###### defer

```html
<script type="text/javascript" src="path/to/script1.js" defer></script>
<script type="text/javascript" src="path/to/script2.js" defer></script>
```

defer 속성을 가진 스크립트는 순서대로( script1 -> script2 ) 실행된다. 이것은 또한 브라우저를 차단하지 않는다. defer는 비동기 스크립트와는 다르게 지연 스크립트는 전체문서가 로드된 후에만 실행된다.

_script 문서간 의존성이 있다면 사용하면 좋겠네?_ 

4. ### 결론

`<head>` 태그에 `<script>`를 넣고 async 또는 defer 속성을 사용하는 것이다. 이렇게하면 브라우저를 차단하지 않고도 스크립트를 최대한 빨리 다운로드 할 수 있다.
